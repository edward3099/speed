
> speed-date@0.1.0 test
> playwright test tests/load-test-50males-20females.spec.ts

[dotenv@17.2.3] injecting env (6) from .env.local -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

Running 1 test using 1 worker
[dotenv@17.2.3] injecting env (0) from .env.local -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
(node:70871) Warning: The 'NO_COLOR' env is ignored due to the 'FORCE_COLOR' env being set.
(Use `node --trace-warnings ...` to show where the warning was created)
ğŸŒ Testing against Vercel: https://speed-l7srpf28o-eds-projects-934496ce.vercel.app
ğŸ‘¤ Creating 1 male users via backend...
âœ… All 1 male users created
ğŸ‘¤ Creating 1 female users via backend...
âœ… All 1 female users created
ğŸŒ Opening browser contexts for all users...
âœ… Created 2 browser contexts
ğŸ” Signing in all users (batched to avoid server overload)...
  Signing in batch 1/1 (2 users)...
  âœ… Batch 1 complete: 2/2 users signed in
âœ… Sign-in complete: 2/2 users successfully signed in
ğŸ° 2 users clicking Start Spin (in batches)...
  Batch 1/1: 2 users clicking Start Spin...
    male Test Male 1: Clicking spin from https://speed-l7srpf28o-eds-projects-934496ce.vercel.app/spin
    female Test Female 1: Clicking spin from https://speed-l7srpf28o-eds-projects-934496ce.vercel.app/spin
    female Test Female 1: After click - URL: https://speed-l7srpf28o-eds-projects-934496ce.vercel.app/voting-window?matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42, API state: matched, matched: true, hasPartner: true
    male Test Male 1: After click - URL: https://speed-l7srpf28o-eds-projects-934496ce.vercel.app/voting-window?matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42, API state: matched, matched: true, hasPartner: true
  âœ… Batch 1 complete
âœ… 2 users clicked Start Spin
â³ Waiting for spin API calls to complete (3 seconds)...
ğŸ“ Checking user URLs after spin:
  - male Test Male 1: https://speed-l7srpf28o-eds-projects-934496ce.vercel.app/voting-window?matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
  - female Test Female 1: https://speed-l7srpf28o-eds-projects-934496ce.vercel.app/voting-window?matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
â³ Waiting for matches to occur (45 seconds)...
  ğŸ” Checking match status via API...
    male Test Male 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
    female Test Female 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
  ğŸ” Checking match status via API...
    male Test Male 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
    female Test Female 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
  ğŸ” Checking match status via API...
    male Test Male 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
    female Test Female 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
  ğŸ” Checking match status via API...
    male Test Male 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
    female Test Female 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
  ğŸ” Checking match status via API...
    male Test Male 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
    female Test Female 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
  ğŸ” Checking match status via API...
    male Test Male 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
    female Test Female 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
  ğŸ” Checking match status via API...
    male Test Male 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
    female Test Female 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
  ğŸ” Checking match status via API...
    male Test Male 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
    female Test Female 1: state=matched, matched=true, matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
ğŸ“Š Checking match status for all signed-in users...

ğŸ—³ï¸ Testing voting flow: BOTH users vote "yes" â†’ should redirect to /video-date...
  Found match b56b0fd9-bbeb-434b-9b02-1c34f0c31e42 with 2 users - testing both_yes scenario...
  â³ Waiting for both users to reach voting-window...
  â³ Waiting for voting window to be fully loaded...
  ğŸ“ User 0 current URL: https://speed-l7srpf28o-eds-projects-934496ce.vercel.app/voting-window?matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
  ğŸ“ User 1 current URL: https://speed-l7srpf28o-eds-projects-934496ce.vercel.app/voting-window?matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
  ğŸ‘† Both users clicking "Yes" - male user and female user...
  ğŸ”˜ male user: Clicking Yes button...
  âœ… male user clicked "Yes" (button text: "âœ“ Yes", disabled: true)
  ğŸ”˜ female user: Clicking Yes button...
  âŒ Failed to click Yes for female user: locator.textContent: Timeout 30000ms exceeded.
Call log:
[2m  - waiting for getByRole('button', { name: /yes/i })[22m

  â³ Waiting for both votes to be processed and redirect to /video-date (10 seconds)...
  â³ Checking if both users are redirected to /video-date...
  ğŸ“ Final URLs after both voting yes:
     - male user: https://speed-l7srpf28o-eds-projects-934496ce.vercel.app/video-date?matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
     - female user: https://speed-l7srpf28o-eds-projects-934496ce.vercel.app/video-date?matchId=b56b0fd9-bbeb-434b-9b02-1c34f0c31e42
  âœ… CORRECT: Both users redirected to /video-date after both voting yes!
     - male user â†’ /video-date âœ“
     - female user â†’ /video-date âœ“
  ğŸ“‹ Browser console messages: [0] ğŸ”˜ Yes button clicked {matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42, userVote: null} | [0] ğŸ“¤ Sending vote: {matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42, voteType: yes} | [0] ğŸ“¥ Vote response: {status: 200, ok: true, statusText: } | [0] ğŸ“¥ Vote response data: {message: Waiting for partner to vote, outcome: null, completed: false, debug_info: Object} | [0] â³ Waiting for partner to vote {message: Waiting for partner to vote, matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42} | [0] ğŸ” Checking match outcome immediately after vote... {matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42} | [0] ğŸ” Checking match outcome immediately after vote... {matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42} | [0] ğŸ” Checking match outcome immediately after vote... {matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42} | [1] ğŸ”˜ Yes button clicked {matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42, userVote: null} | [1] ğŸ“¤ Sending vote: {matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42, voteType: yes} | [1] âœ… Polling found both_yes outcome, redirecting to video-date {matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42, matchCheckData: Object} | [1] ğŸ“¥ Vote response: {status: 200, ok: true, statusText: } | [1] ğŸ“¥ Vote response data: {outcome: both_yes, completed: true} | [1] âœ… Both users voted yes, redirecting to video-date immediately {outcome: both_yes, matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42} | [0] âœ… Polling found both_yes outcome, redirecting to video-date {matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42, matchCheckData: Object} | [1] âœ… Polling found both_yes outcome, redirecting to video-date {matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42, matchCheckData: Object} | [0] âœ… Polling found both_yes outcome, redirecting to video-date {matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42, matchCheckData: Object} | [1] âœ… Polling found both_yes outcome, redirecting to video-date {matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42, matchCheckData: Object} | [0] âœ… Polling found both_yes outcome, redirecting to video-date {matchId: b56b0fd9-bbeb-434b-9b02-1c34f0c31e42, matchCheckData: Object} | [1] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [1] could not fetch region settings {room: , roomID: undefined, participant: , pID: , error: ConnectionError: Could not fetch region settings: 
    at sA.<anonymous> (https://speed-l7srpf28o-eâ€¦} | [0] could not fetch region settings {room: , roomID: undefined, participant: , pID: , error: ConnectionError: Could not fetch region settings: 
    at sA.<anonymous> (https://speed-l7srpf28o-eâ€¦} | [1] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [1] âŒ Failed to connect to LiveKit room: {message: could not establish signal connection: invalid API key, name: ConnectionError, error: ConnectionError: could not establish signal connection: invalid API key
    at oS.<anonymous> (httpâ€¦} | [0] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [1] â±ï¸ Initial countdown from database: 10 seconds | [0] âŒ Failed to connect to LiveKit room: {message: could not establish signal connection: invalid API key, name: ConnectionError, error: ConnectionError: could not establish signal connection: invalid API key
    at oS.<anonymous> (httpâ€¦} | [0] â±ï¸ Initial countdown from database: 9 seconds | [1] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [0] ğŸ”„ Fetching started_at from database after countdown completion... | [1] ğŸ”„ Fetching started_at from database after countdown completion... | [0] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [1] âŒ Real-time subscription error | [0] âŒ Real-time subscription error | [0] âŒ Real-time subscription error

ğŸ“ˆ MATCH ANALYSIS:
Total users created: 2
Successfully signed in: 2
Matched users: 2
Unmatched users: 0
Total matches created: 1
Signed-in females: 1/1
Signed-in males: 1/1
Expected matches: 1 (one per signed-in female, limited by males)

ğŸ” ISSUES FOUND:
âœ… No issues found - all expected matches occurred correctly!

ğŸ“‹ DETAILED BREAKDOWN:
Matched females: 1/1 (0 failed to sign in)
Matched males: 1/1 (0 failed to sign in)
Unmatched females: 0
Unmatched males: 0

ğŸ§¹ Cleaning up all users...

ğŸ‰ TEST PASSED - All expected matches occurred correctly!
ğŸ§¹ Cleaning up test users...
Â·
  1 passed (2.3m)
